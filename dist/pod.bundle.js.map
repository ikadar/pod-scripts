{"version":3,"file":"pod.bundle.js","sources":["../src/logInfo.js","../src/separator-mono.js","../src/render-template.js","../src/pod-prince.js"],"sourcesContent":["const runsInPrince = (typeof Prince !== \"undefined\");\n\nfunction logInfo (info) {\n    if (runsInPrince) {\n        Prince.Log.info(info);\n    } else {\n        console.log(info);\n    }\n}\n\nexport default logInfo;","import logInfo from \"./logInfo\";\nconst runsInPrince = (typeof Prince !== \"undefined\");\n\nconst handleSeparators = () => {\n\n    logInfo(\"HANDLING SEPARATORS 02 - 101\");\n\n    const separatorNodeList = document.querySelectorAll(\".separator\");\n    const separators = Array.from(separatorNodeList);\n\n    logInfo(\"SEPARATORS\", separators.length);\n\n    separators.map((separator) => {\n        const next = separator.nextElementSibling;\n        if (next) {\n            logInfo(\"NEXT\", next);\n            logInfo(\"getYCoordinate(separator)\", getYCoordinate(separator));\n            logInfo(\"getYCoordinate(next)\", getYCoordinate(next));\n            if (getYCoordinate(separator) !== getYCoordinate(next)) {\n                logInfo(\"HIDE SEPARATOR\");\n                separator.style.visibility = \"hidden\";\n            } else {\n                separator.style.visibility = \"visible\";\n            }\n        }\n    });\n};\n\nconst getYCoordinate = (element) => {\n    if (runsInPrince) {\n        return element.getPrinceBoxes()[0].y;\n    } else {\n        return element.getBoundingClientRect().top;\n    }\n};\n\nexport default handleSeparators;\n","import handleSeparators from \"./separator-mono.js\";\nimport logInfo from \"./logInfo\";\n\nwindow.addEventListener('message', (event) => {\n    // console.log('Message received from parent:', event.data);\n\n    const data = {};\n    Object.keys(event.data.data).map((key) => {\n        if (Array.isArray(event.data.data[key]) && (event.data.data[key].length > 0)) {\n            data[key] = event.data.data[key][0].label;\n        } else {\n            data[key] = event.data.data[key];\n        }\n    });\n\n    if (event.data.msgId === \"dataChanged\") {\n        renderTemplate(data, event.data.templateId, event.data.orderLineUuid, event.data.options, false);\n        zoom(event.data.zoom / 100);\n    }\n\n    if (event.data.msgId === \"getRenderedMarkup\") {\n        renderTemplate(data, event.data.templateId, event.data.orderLineUuid, event.data.options, true);\n        zoom(event.data.zoom / 100);\n    }\n\n    if (event.data.msgId === \"zoom\") {\n        zoom(event.data.data / 100);\n    }\n\n});\n\nfunction scriptFromTheTemplate() {\n    logInfo(\"scriptFromTheTemplate\");\n    // replace by the scriptFromTheTemplate\n}\n\nfunction renderTemplate(data, templateId, orderLineUuid, options, sendData) {\n    const source = document.getElementById('entry-template').innerHTML;\n\n    // Wrap each string property in SafeString\n    const safeData = JSON.parse(JSON.stringify(data), (key, value) =>\n        typeof value === 'string' ? value.replace(/\\\\n/g, \"<br />\") : value\n    );\n\n    var renderer = Twig.twig({\n        data: source\n    });\n\n    const html = renderer.render(safeData);\n\n    document.getElementsByTagName('body')[0].outerHTML = html;\n    scriptFromTheTemplate();\n//    handleSeparators();\n//    run();\n    if (sendData) {\n        window.parent.postMessage({source: \"template-processor\", html: html, data: data, templateId: templateId, orderLineUuid: orderLineUuid, options: options}, \"*\");\n    }\n}\n\nfunction zoom(ratio) {\n    const scale = ratio + \" \" + ratio;\n    document.getElementsByTagName('body')[0].style.scale = ratio;\n}\n\nexport default renderTemplate;\n","import handleSeparators from \"./separator-mono.js\";\nimport renderTemplate from \"./render-template\";\n\nfunction addPodScripts() {\n    Prince.Log.info(\"TEST00\");\n    // document.addEventListener(\"DOMContentLoaded\", function () {\n\n        const runsInPrince = (typeof Prince !== \"undefined\");\n\n        function init() {\n            Prince.Log.info(\"TEST02\");\n\n            if (runsInPrince) {\n\n                Prince.Log.info(\"POD_PRINCE\");\n                Prince.Log.info(\"TEST03\");\n\n                Prince.trackBoxes = true;\n\n                // Prince.addEventListener(\"complete\", function() {\n                //     console.log(\"complete\");\n                // }, false);\n\n                Prince.registerPostLayoutFunc(function () {\n                    // renderTemplate();\n                    handleSeparators();\n                });\n\n           } else {\n                renderTemplate({});\n                handleSeparators();\n            }\n\n        }\n\n        if (runsInPrince) {\n            Prince.Log.info(\"TEST01b\");\n            init();\n            // setTimeout(init, 5000);\n        } else {\n            init();\n        }\n\n    // });\n\n}\n\nif (typeof window !== 'undefined') {\n    window.addPodScripts = addPodScripts;\n}\nexport default addPodScripts;"],"names":["runsInPrince","Prince","logInfo","info","Log","console","log","handleSeparators","separatorNodeList","document","querySelectorAll","separators","Array","from","length","map","separator","next","nextElementSibling","getYCoordinate","style","visibility","element","getPrinceBoxes","y","getBoundingClientRect","top","window","addEventListener","event","data","Object","keys","key","isArray","label","msgId","renderTemplate","templateId","orderLineUuid","options","zoom","scriptFromTheTemplate","sendData","source","getElementById","innerHTML","safeData","JSON","parse","stringify","value","replace","renderer","Twig","twig","html","render","getElementsByTagName","outerHTML","parent","postMessage","ratio","scale","addPodScripts","init","trackBoxes","registerPostLayoutFunc"],"mappings":"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"}